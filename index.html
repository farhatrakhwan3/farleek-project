<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Farleek Pro • 2025</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(to bottom, #000000, #0a0a0a);
      color: #f1f1f1;
    }
    .glass {
      background: rgba(20, 20, 25, 0.65);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.07);
      box-shadow: 0 8px 32px rgba(0,0,0,0.45);
    }
    .typing-dot {
      animation: blink 1.4s infinite both;
    }
    @keyframes blink {
      0%, 100% { opacity: 0.25; transform: scale(0.75); }
      50%      { opacity: 1;    transform: scale(1.15); }
    }
    #chat-display {
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }
  </style>
</head>
<body class="min-h-screen antialiased selection:bg-purple-600/30">

<!-- Sidebar -->
<aside class="fixed inset-y-0 left-0 z-50 w-80 bg-black/90 border-r border-white/5 transform -translate-x-full md:translate-x-0 transition-transform duration-500 ease-out">
  <div class="flex flex-col h-full p-6">
    <div class="flex items-center gap-3 mb-10">
      <div class="w-11 h-11 bg-gradient-to-br from-violet-600 via-purple-600 to-fuchsia-600 rounded-2xl flex items-center justify-center shadow-lg shadow-purple-900/40">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
        </svg>
      </div>
      <h1 class="text-3xl font-black tracking-tighter bg-gradient-to-r from-white to-zinc-400 bg-clip-text text-transparent">Farleek</h1>
    </div>

    <button id="new-chat-btn" class="group relative w-full bg-gradient-to-r from-violet-600 to-purple-700 hover:from-violet-500 hover:to-purple-600 text-white font-semibold py-4 rounded-2xl transition-all duration-300 shadow-lg shadow-purple-900/30 hover:shadow-purple-700/40 mb-10">
      <span class="relative z-10 flex items-center justify-center gap-2 text-lg">
        + New Conversation
      </span>
    </button>

    <div class="flex-1 overflow-y-auto scrollbar-none">
      <h2 class="text-xs uppercase tracking-widest text-zinc-500 font-semibold mb-5 px-1">Recent</h2>
      <div id="history-list" class="space-y-2"></div>
    </div>

    <button id="clear-btn" class="mt-6 text-sm text-zinc-600 hover:text-red-400 transition-colors text-left px-2 py-1.5">
      Clear All Memory
    </button>
  </div>
</aside>

<!-- Main Content -->
<main class="md:ml-80 min-h-screen flex flex-col relative">

  <!-- Mobile Header -->
  <header class="md:hidden sticky top-0 z-40 bg-black/80 backdrop-blur-xl border-b border-white/5">
    <div class="flex items-center justify-between px-5 py-4">
      <span class="font-black text-2xl tracking-tighter bg-gradient-to-r from-white to-zinc-400 bg-clip-text text-transparent">Farleek</span>
      <button id="menu-toggle" class="text-2xl text-zinc-300">☰</button>
    </div>
  </header>

  <!-- Chat Area -->
  <div id="chat-display" class="flex-1 overflow-y-auto px-5 md:px-16 py-12 pb-60 space-y-10 scrollbar-thin scrollbar-thumb-zinc-800 scrollbar-track-transparent">
    <div id="welcome-screen" class="text-center mt-24 md:mt-32">
      <h1 class="text-7xl md:text-9xl font-black tracking-tighter bg-gradient-to-b from-white via-zinc-300 to-zinc-700 bg-clip-text text-transparent">
        Farleek
      </h1>
      <p class="mt-6 text-zinc-400 text-xl font-light">Ultra • Fast • Intelligent</p>
    </div>
  </div>

  <!-- Input Area -->
  <div class="fixed bottom-0 inset-x-0 md:left-80 z-30 px-5 md:px-16 pb-8 pt-16 bg-gradient-to-t from-black via-black/95 to-transparent pointer-events-none">
    <div class="pointer-events-auto max-w-5xl mx-auto space-y-6">

      <!-- Mode Selector -->
      <div class="flex justify-center">
        <div class="glass inline-flex p-1.5 rounded-2xl gap-1.5 shadow-xl shadow-black/60 flex-wrap justify-center">
          <button onclick="setMode('text-gemini')" class="mode-btn active px-8 py-2.5 rounded-xl text-xs font-black tracking-widest transition-all" data-mode="text-gemini">GEMINI</button>
          <button onclick="setMode('image')" class="mode-btn px-8 py-2.5 rounded-xl text-xs font-black tracking-widest text-zinc-400 hover:text-white transition-all" data-mode="image">IMAGE</button>
          <button onclick="setMode('pro')" class="mode-btn px-8 py-2.5 rounded-xl text-xs font-black tracking-widest text-zinc-400 hover:text-white transition-all" data-mode="pro">PRO CODE</button>
        </div>
      </div>

      <!-- Input Container -->
      <div class="glass rounded-[2.5rem] p-3 flex items-end gap-3 shadow-2xl shadow-black/70 border border-white/5">
        <label for="file-input" class="p-4 hover:bg-white/5 rounded-2xl cursor-pointer text-zinc-400 hover:text-zinc-200 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
        </label>

        <textarea id="user-input" rows="1" placeholder="How can Farleek help you today..." 
          class="flex-1 bg-transparent border-0 focus:ring-0 text-lg md:text-xl text-white placeholder-zinc-500 resize-none max-h-48 py-4 px-2 outline-none"></textarea>

        <button id="send-btn" class="bg-gradient-to-r from-purple-500 to-violet-600 hover:from-purple-600 hover:to-violet-700 text-white p-4 rounded-2xl transition-all duration-300 active:scale-95 shadow-lg shadow-purple-900/40">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5L12 3m0 0l7.5 7.5M12 3v18" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</main>

<script type="module">
  import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

  // ── CONFIG ────────────────────────────────────────────────────────────────
  const GEMINI_KEY = "YOUR_GEMINI_API_KEY_HERE"; // ← Replace with your actual key from https://aistudio.google.com/app/apikey

  const sysPrompt = `Your name is Farleek. You are a professional, ultra-capable AI assistant. 
If someone asks about you or the creator, say: "I am Farleek. Created by Farhat rakhwan at 7 years".
- TEXT mode: Be concise, clear, insightful.
- PRO CODE mode: Provide complete, working, single-file HTML/CSS/JS solutions with modern dark-themed UI.
- Never mention providers or APIs. You are Farleek.`;

  const genAI = new GoogleGenerativeAI(GEMINI_KEY);
  const geminiModel = genAI.getGenerativeModel({ 
    model: "gemini-1.5-flash",
    systemInstruction: sysPrompt
  });

  // ── DOM & STATE ───────────────────────────────────────────────────────────
  const chatDisplay = document.getElementById('chat-display');
  const welcomeScreen = document.getElementById('welcome-screen');
  const userInput = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  const fileInput = document.getElementById('file-input');

  let chatData = JSON.parse(localStorage.getItem('farleek_v1')) || [];
  let currentMode = 'text-gemini';
  let attachedFile = "";

  // Reliable auto-scroll
  function scrollToBottom() {
    requestAnimationFrame(() => {
      chatDisplay.scrollTo({
        top: chatDisplay.scrollHeight,
        behavior: 'smooth'
      });
    });
  }

  window.setMode = (m) => {
    currentMode = m;
    document.querySelectorAll('.mode-btn').forEach(b => {
      b.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-violet-600', 'text-white', 'shadow-lg', 'shadow-purple-900/40');
      b.classList.add('text-zinc-400');
    });
    const active = document.querySelector(`.mode-btn[data-mode="${m}"]`);
    if (active) {
      active.classList.remove('text-zinc-400');
      active.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-violet-600', 'text-white', 'shadow-lg', 'shadow-purple-900/40');
    }
  };

  function createMessage(role) {
    welcomeScreen.classList.add('hidden');
    const wrap = document.createElement('div');
    wrap.className = `w-full flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-in mb-8`;
    const box = document.createElement('div');
    box.className = `p-6 rounded-[2rem] text-[16px] leading-relaxed max-w-[95%] md:max-w-[80%] ${role === 'user' ? 'bg-purple-600 text-white rounded-tr-none' : 'glass text-zinc-100 rounded-tl-none'}`;
    wrap.appendChild(box);
    chatDisplay.appendChild(wrap);
    return box;
  }

  async function handleSend() {
    const prompt = userInput.value.trim();
    if (!prompt && !attachedFile) return;

    const userBox = createMessage('user');
    userBox.innerText = prompt;
    chatData.push({ role: 'user', text: prompt });
    userInput.value = "";
    userInput.style.height = 'auto';

    scrollToBottom();

    const aiBox = createMessage('ai');
    aiBox.innerHTML = `<div class="flex gap-1.5 py-3"><div class="typing-dot w-2 h-2 bg-purple-400 rounded-full"></div><div class="typing-dot w-2 h-2 bg-purple-400 rounded-full" style="animation-delay:0.2s"></div><div class="typing-dot w-2 h-2 bg-purple-400 rounded-full" style="animation-delay:0.4s"></div></div>`;
    scrollToBottom();

    try {
      if (currentMode === 'text-gemini' || currentMode === 'pro') {
        await handleTextGeneration(prompt, aiBox);
      } else if (currentMode === 'image') {
        await handleImageGeneration(prompt, aiBox);
      }
    } catch (err) {
      aiBox.innerText = `Error: ${err.message}`;
      console.error(err);
    } finally {
      attachedFile = "";
      localStorage.setItem('farleek_v1', JSON.stringify(chatData));
      scrollToBottom();
    }
  }

  async function handleTextGeneration(prompt, aiBox) {
    const isPro = currentMode === 'pro';
    const modeText = isPro ? 'PRO CODE' : 'TEXT';
    const fullPrompt = `${attachedFile ? "[File Context] " + attachedFile : ""} Mode: ${modeText}. Request: ${prompt}`;

    let accumulated = "";
    aiBox.innerHTML = "";

    const stream = await geminiModel.generateContentStream(fullPrompt);
    for await (const chunk of stream.stream) {
      accumulated += chunk.text();
      updateAiBox(aiBox, accumulated, isPro);
    }

    chatData.push({ role: 'ai', text: accumulated });
    scrollToBottom();
  }

  async function handleImageGeneration(prompt, aiBox) {
    const seed = Math.floor(Math.random() * 1000000);
    const url = `https://pollinations.ai/p/${encodeURIComponent(prompt)}?width=1024&height=1024&nologo=true&seed=${seed}&model=flux`;
    
    aiBox.innerHTML = `<img src="${url}" class="rounded-3xl w-full shadow-2xl border border-white/5" alt="Generated Image" onload="scrollToBottom()">`;
    chatData.push({ role: 'ai', text: url, isImage: true });
    scrollToBottom();
  }

  function updateAiBox(box, text, isPro) {
    box.innerHTML = text
      .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
      .replace(/`([^`]+)`/g, '<code>$1</code>');
    
    if (isPro) {
      const codeMatch = text.match(/```(?:html|javascript|css|)?\s*([\s\S]*?)\s*```/);
      if (codeMatch && !box.querySelector('.run-preview-btn')) {
        const btn = document.createElement('button');
        btn.className = "run-preview-btn mt-6 w-full bg-white text-black font-black py-3 rounded-2xl text-xs tracking-widest uppercase hover:bg-purple-600 hover:text-white transition-all";
        btn.textContent = "Run Preview";
        btn.onclick = () => {
          const iframe = document.createElement('iframe');
          iframe.className = "w-full h-[500px] mt-6 rounded-2xl border border-zinc-700 bg-white";
          iframe.srcdoc = codeMatch[1];
          box.appendChild(iframe);
          btn.remove();
          scrollToBottom();
        };
        box.appendChild(btn);
      }
    }
    
    scrollToBottom();
  }

  // ── EVENT LISTENERS ───────────────────────────────────────────────────────
  sendBtn.onclick = handleSend;

  userInput.onkeydown = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  fileInput.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      attachedFile = ev.target.result;
      alert("File attached: " + file.name);
    };
    reader.readAsText(file);
  };

  document.getElementById('new-chat-btn').onclick = () => {
    localStorage.removeItem('farleek_v1');
    location.reload();
  };

  document.getElementById('menu-toggle').onclick = () => {
    document.querySelector('aside').classList.toggle('-translate-x-full');
  };

</script>
</body>
</html>
